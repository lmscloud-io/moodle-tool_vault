{"version":3,"file":"apikey_amd.min.js","sources":["../src/apikey_amd.js"],"sourcesContent":["// This file is part of plugin tool_vault - https://lmsvault.io\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AMD module for older versions of Moodle\n *\n * @module     tool_vault/apikey_amd\n * @copyright  2024 Marina Glancy\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([], function() {\n\n    var SELECTORS = {\n        APIKEY_FORM_CONTAINER: '#getapikey_formplaceholder',\n        APIKEY_IFRAME: '#getapikey_iframe',\n        SIGNIN_BUTTON: '#getapikey_signin',\n        SIGNUP_BUTTON: '#getapikey_signup',\n        ENTER_KEY_BUTTON: '#getapikey_enterapikey',\n        LEGACY_FORM_CONTAINER: '#getapikey_legacyform'\n    };\n\n    /**\n     * Open iframe with the remote login/signup form\n     *\n     * @param {Event} e\n     */\n    var openLoginSignupModal = function(e) {\n        document.querySelector(SELECTORS.APIKEY_FORM_CONTAINER).innerHTML = '';\n        var formContainer = document.querySelector(SELECTORS.LEGACY_FORM_CONTAINER);\n        if (formContainer) {\n            formContainer.classList.add('hidden');\n        }\n\n        var signInButton = e.target;\n        var loginSignupIframe = document.querySelector(SELECTORS.APIKEY_IFRAME);\n        var url = (signInButton && loginSignupIframe) ? signInButton.dataset.target : null;\n\n        loginSignupIframe.src = url;\n        loginSignupIframe.style.display = 'block';\n    };\n\n    /**\n     * Close iframe with the remote login/signup form\n     */\n    var closeLoginSignupModal = function() {\n        var loginSignupIframe = document.querySelector(SELECTORS.APIKEY_IFRAME);\n        loginSignupIframe.style.display = 'none';\n        loginSignupIframe.src = 'about:blank';\n    };\n\n    var init = function(onMessage) {\n        var signInButton = document.querySelector(SELECTORS.SIGNIN_BUTTON);\n        var signUpButton = document.querySelector(SELECTORS.SIGNUP_BUTTON);\n        var loginSignupIframe = document.querySelector(SELECTORS.APIKEY_IFRAME);\n        var url = (signInButton && loginSignupIframe) ? signInButton.dataset.target : null;\n\n        if (!url) {\n            return;\n        }\n        var urlHost = url.match(/^(https?:\\/\\/[^/]+)(.*)$/)[1];\n\n        signInButton.onclick = openLoginSignupModal;\n        if (signUpButton) {\n            signUpButton.onclick = openLoginSignupModal;\n        }\n\n        var enterApikeyButton = document.querySelector(SELECTORS.ENTER_KEY_BUTTON);\n        enterApikeyButton.addEventListener('click', function() {\n            closeLoginSignupModal();\n        });\n\n        window.addEventListener(\n            \"message\",\n            function(event) {\n                if (event.origin !== urlHost || !event.data || !(typeof event.data === 'object')) {\n                    return;\n                }\n                if (event.data.action === 'close') {\n                    closeLoginSignupModal();\n                } else {\n                    onMessage(event);\n                }\n            },\n            false);\n    };\n\n    /**\n     * Open form to enter API key\n     *\n     * @param {String} apikey\n     * @param {Boolean} autoSubmit\n     */\n    var openApikeyForm = function(apikey, autoSubmit) {\n        closeLoginSignupModal();\n        var formContainer = document.querySelector(SELECTORS.LEGACY_FORM_CONTAINER);\n        formContainer.classList.remove('hidden');\n\n        if (apikey && apikey !== '') {\n            formContainer.querySelector('input[name=\"apikey\"]').value = apikey;\n            if (autoSubmit) {\n                formContainer.querySelector('input[name=\"submitbutton\"]').click();\n            }\n        }\n    };\n\n    return {\n        // Public variables and functions.\n\n        /**\n         * Initialise the module.\n         *\n         * @method init\n         */\n        'init': function() {\n            init(function(event) {\n                if (event.data.action === 'apikey') {\n                    openApikeyForm(event.data.apikey, true);\n                }\n            });\n\n            var enterApikeyButton = document.querySelector(SELECTORS.ENTER_KEY_BUTTON);\n            enterApikeyButton.addEventListener('click', function() {\n                openApikeyForm();\n            });\n        }\n    };\n});\n"],"names":["define","SELECTORS","openLoginSignupModal","e","document","querySelector","innerHTML","formContainer","classList","add","signInButton","target","loginSignupIframe","url","dataset","src","style","display","closeLoginSignupModal","openApikeyForm","apikey","autoSubmit","remove","value","click","onMessage","signUpButton","urlHost","match","onclick","addEventListener","window","event","origin","data","_typeof","action","init"],"mappings":";;;;;;;IAuBAA,+BAAO,IAAI,eAEHC,gCACuB,6BADvBA,wBAEe,oBAFfA,wBAGe,oBAHfA,wBAIe,oBAJfA,2BAKkB,yBALlBA,gCAMuB,wBAQvBC,qBAAuB,SAASC,GAChCC,SAASC,cAAcJ,iCAAiCK,UAAY,OAChEC,cAAgBH,SAASC,cAAcJ,iCACvCM,eACAA,cAAcC,UAAUC,IAAI,cAG5BC,aAAeP,EAAEQ,OACjBC,kBAAoBR,SAASC,cAAcJ,yBAC3CY,IAAOH,cAAgBE,kBAAqBF,aAAaI,QAAQH,OAAS,KAE9EC,kBAAkBG,IAAMF,IACxBD,kBAAkBI,MAAMC,QAAU,SAMlCC,sBAAwB,eACpBN,kBAAoBR,SAASC,cAAcJ,yBAC/CW,kBAAkBI,MAAMC,QAAU,OAClCL,kBAAkBG,IAAM,eA6CxBI,eAAiB,SAASC,OAAQC,YAClCH,4BACIX,cAAgBH,SAASC,cAAcJ,iCAC3CM,cAAcC,UAAUc,OAAO,UAE3BF,QAAqB,KAAXA,SACVb,cAAcF,cAAc,wBAAwBkB,MAAQH,OACxDC,YACAd,cAAcF,cAAc,8BAA8BmB,gBAK/D,MAQK,YA/DD,SAASC,eACZf,aAAeN,SAASC,cAAcJ,yBACtCyB,aAAetB,SAASC,cAAcJ,yBACtCW,kBAAoBR,SAASC,cAAcJ,yBAC3CY,IAAOH,cAAgBE,kBAAqBF,aAAaI,QAAQH,OAAS,QAEzEE,SAGDc,QAAUd,IAAIe,MAAM,4BAA4B,GAEpDlB,aAAamB,QAAU3B,qBACnBwB,eACAA,aAAaG,QAAU3B,sBAGHE,SAASC,cAAcJ,4BAC7B6B,iBAAiB,SAAS,WACxCZ,2BAGJa,OAAOD,iBACH,WACA,SAASE,OACDA,MAAMC,SAAWN,SAAYK,MAAME,MAAgC,WAAtBC,QAAOH,MAAME,QAGpC,UAAtBF,MAAME,KAAKE,OACXlB,wBAEAO,UAAUO,WAGlB,IA+BAK,EAAK,SAASL,OACgB,WAAtBA,MAAME,KAAKE,QACXjB,eAAea,MAAME,KAAKd,QAAQ,MAIlBhB,SAASC,cAAcJ,4BAC7B6B,iBAAiB,SAAS,WACxCX"}