define(["core/modal_factory","core/modal_events","core/templates","core/notification","core/str","core/pending","core/fragment"],function(a,b,c,d,e,f,g){var h={START_BACKUP:'form[data-action="startbackup"]',START_DRYRUN:'form[data-action="startdryrun"]',START_RESTORE:'form[data-action="startrestore"]'},i=function(a,b){var c=b.getBody()[0],d=["passphrase","description"];for(var e in d){var f=c.querySelector('input[name="'+d[e]+'"]'),g=a.querySelector('input[name="'+d[e]+'"]');f&&g&&(g.value=f.value)}a.setAttribute("action",a.getAttribute("data-url")),a.submit()},j=function(b,c,e,f,h){var i=null;return a.create({type:a.types.CANCEL,title:b,body:c}).then(function(a){return i=a,i.show(),g.loadFragment("tool_vault",e,f,h)}).then(function(a){return i.destroy(),a})["catch"](function(a){i?i.setBody(a.message):d.exception(a)})},k=function(b){var c,d,f;return e.get_strings([{key:"startbackup",component:"tool_vault"},{key:"pleasewait",component:"tool_vault"},{key:"startbackup",component:"tool_vault"}]).then(function(a){return c=a[0],d=a[1],f=a[2],j(c,d,"start_backup",b)}).then(function(b){return b?a.create({type:a.types.SAVE_CANCEL,title:c,body:b,buttons:{save:f},removeOnClose:!0}):null})},l=function(){var a=document.querySelector(h.START_BACKUP);if(a){var c=a.getAttribute("data-contextid");a.addEventListener("submit",function(e){e.preventDefault();var g=new f("tool/vault:startBackupPopup");k(c).then(function(c){return c&&(c.show(),c.getRoot().on(b.save,function(){i(a,c)}),c.getRoot().on(b.cancel,function(){c.hide()})),g.resolve(),null})["catch"](function(a){d.exception(a),g.resolve()})})}},m=function(f){var g=document.querySelector(h.START_DRYRUN+'[data-backupkey="'+f+'"]');g&&g.addEventListener("submit",function(f){f.preventDefault(),a.create({type:a.types.SAVE_CANCEL,title:e.get_string("startdryrun","tool_vault"),body:c.render("tool_vault/start_restore_popup",{dryrun:1,encrypted:parseInt(g.getAttribute("data-encrypted"))}),buttons:{save:e.get_string("startdryrun","tool_vault")},removeOnClose:!0}).then(function(a){return a.show(),a.getRoot().on(b.save,function(){i(g,a)}),a.getRoot().on(b.cancel,function(){a.hide()}),a})["catch"](d.exception)})},n=function(f){var g=document.querySelector(h.START_RESTORE+'[data-backupkey="'+f+'"]');g&&g.addEventListener("submit",function(f){f.preventDefault(),a.create({type:a.types.SAVE_CANCEL,title:e.get_string("startrestore","tool_vault"),body:c.render("tool_vault/start_restore_popup",{dryrun:0,encrypted:parseInt(g.getAttribute("data-encrypted"))}),buttons:{save:e.get_string("startrestore","tool_vault")},removeOnClose:!0}).then(function(a){return a.show(),a.getRoot().on(b.save,function(){i(g,a)}),a.getRoot().on(b.cancel,function(){a.hide()}),a})["catch"](d.exception)})},o=function(){var a=document.querySelector('[data-vault-purpose="logslong"]'),b=document.querySelector('[data-vault-purpose="logsshort"]');return a&&b&&(a.querySelector('[data-vault-purpose="togglelogs"]').addEventListener("click",function(c){c.preventDefault(),b.style.display="block",a.style.display="none"}),b.querySelector('[data-vault-purpose="togglelogs"]').addEventListener("click",function(c){c.preventDefault(),b.style.display="none",a.style.display="block"})),!1};return{initStartBackup:l,initStartDryRun:m,initStartRestore:n,initCollapseExpandBackupLogs:o}});