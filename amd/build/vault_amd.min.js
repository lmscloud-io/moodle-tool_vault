function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}
/**
 * TODO describe module vault_amd
 *
 * @module     tool_vault/vault_amd
 * @copyright  2024 Marina Glancy
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("tool_vault/vault_amd",["core/modal_factory","core/modal_events","core/templates","core/notification","core/str","core/pending","core/fragment"],(function(ModalFactory,ModalEvents,Templates,Notification,Str,Pending,Fragment){var SELECTORS_START_BACKUP='form[data-action="startbackup"]',SELECTORS_START_DRYRUN='form[data-action="startdryrun"]',SELECTORS_START_RESTORE='form[data-action="startrestore"]',submitForm=function(backupForm,modal){var popupBody=modal.getBody()[0],fields=["passphrase","description"];for(var i in fields){var el1=popupBody.querySelector('input[name="'+fields[i]+'"]'),el2=backupForm.querySelector('input[name="'+fields[i]+'"]');el1&&el2&&(el2.value=el1.value)}backupForm.setAttribute("action",backupForm.getAttribute("data-url")),backupForm.submit()},x=function(contextid){var title,tempBody,saveButtonText;return Str.get_strings([{key:"startbackup",component:"tool_vault"},{key:"pleasewait",component:"tool_vault"},{key:"startbackup",component:"tool_vault"}]).then((function(s){return title=s[0],tempBody=s[1],saveButtonText=s[2],function(title,tempBody,fragmentName,contextid,args){var activeModal=null;return ModalFactory.create({type:ModalFactory.types.CANCEL,title:title,body:tempBody}).then((function(res){return(activeModal=res).show(),Fragment.loadFragment("tool_vault",fragmentName,contextid,args)})).then((function(fragment){return activeModal.destroy(),fragment})).catch((function(e){activeModal?activeModal.setBody(e.message):Notification.exception(e)}))}(title,tempBody,"start_backup",contextid)})).then((function(fragment){return fragment?ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:title,body:fragment,buttons:{save:saveButtonText},removeOnClose:!0}):null}))};return{initStartBackup:function(){var backupForm=document.querySelector(SELECTORS_START_BACKUP);if(backupForm){var fn,_ref,contextid=backupForm.getAttribute("data-contextid");backupForm.addEventListener("submit",(fn=regeneratorRuntime.mark((function _callee(event){var pendingPromise;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:event.preventDefault(),pendingPromise=new Pending("tool/vault:startBackupPopup"),x(contextid).then((function(modal){return modal&&(modal.show(),modal.getRoot().on(ModalEvents.save,(function(){return submitForm(backupForm,modal)})),modal.getRoot().on(ModalEvents.cancel,(function(){return modal.hide()}))),pendingPromise.resolve(),null})).catch((function(e){Notification.exception(e),pendingPromise.resolve()}));case 3:case"end":return _context.stop()}}),_callee)})),_ref=function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))},function(_x){return _ref.apply(this,arguments)}))}},initStartDryRun:function(backupkey){var dryrunForm=document.querySelector(SELECTORS_START_DRYRUN+'[data-backupkey="'.concat(backupkey,'"]'));dryrunForm&&dryrunForm.addEventListener("submit",(function(event){event.preventDefault(),ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:Str.get_string("startdryrun","tool_vault"),body:Templates.render("tool_vault/start_restore_popup",{dryrun:1,encrypted:parseInt(dryrunForm.getAttribute("data-encrypted"))}),buttons:{save:Str.get_string("startdryrun","tool_vault")},removeOnClose:!0}).then((function(modal){return modal.show(),modal.getRoot().on(ModalEvents.save,(function(){return submitForm(dryrunForm,modal)})),modal.getRoot().on(ModalEvents.cancel,(function(){return modal.hide()})),modal})).catch(Notification.exception)}))},initStartRestore:function(backupkey){var restoreForm=document.querySelector(SELECTORS_START_RESTORE+'[data-backupkey="'.concat(backupkey,'"]'));restoreForm&&restoreForm.addEventListener("submit",(function(event){event.preventDefault(),ModalFactory.create({type:ModalFactory.types.SAVE_CANCEL,title:Str.get_string("startrestore","tool_vault"),body:Templates.render("tool_vault/start_restore_popup",{dryrun:0,encrypted:parseInt(restoreForm.getAttribute("data-encrypted"))}),buttons:{save:Str.get_string("startrestore","tool_vault")},removeOnClose:!0}).then((function(modal){return modal.show(),modal.getRoot().on(ModalEvents.save,(function(){return submitForm(restoreForm,modal)})),modal.getRoot().on(ModalEvents.cancel,(function(){return modal.hide()})),modal})).catch(Notification.exception)}))},initCollapseExpandBackupLogs:function(){var logslong=document.querySelector('[data-vault-purpose="logslong"]'),logsshort=document.querySelector('[data-vault-purpose="logsshort"]');return logslong&&logsshort&&(logslong.querySelector('[data-vault-purpose="togglelogs"]').addEventListener("click",(function(event){event.preventDefault(),logsshort.style.display="block",logslong.style.display="none"})),logsshort.querySelector('[data-vault-purpose="togglelogs"]').addEventListener("click",(function(event){event.preventDefault(),logsshort.style.display="none",logslong.style.display="block"}))),!1}}}));

//# sourceMappingURL=vault_amd.min.js.map