define("tool_vault/install_addon",["exports","core_form/modalform","./selectors","core/str","core/notification"],(function(_exports,_modalform,_selectors,_str,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Links to install add-on plugins
   *
   * @module     tool_vault/install_addon
   * @copyright  Marina Glancy
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modalform=_interopRequireDefault(_modalform),_notification=_interopRequireDefault(_notification);let initialised=!1;_exports.init=()=>{initialised||(initialised=!0,document.querySelectorAll(_selectors.SELECTORS.ADDON_PLUGIN_REGION).forEach((pluginRegionNode=>{const installButton=pluginRegionNode.dataset.writable?pluginRegionNode.querySelector(_selectors.SELECTORS.ADDON_INSTALL_BUTTON):null;null==installButton||installButton.addEventListener("click",(e=>{e.preventDefault(),pluginRegionNode.dataset.isbulk?openInstallAddonForm(pluginRegionNode.dataset.pluginnames.split(",")):openInstallAddonForm([pluginRegionNode.dataset.pluginname])}))})))};const getPluginRegion=pluginname=>document.querySelector(_selectors.SELECTORS.ADDON_PLUGIN_REGION+'[data-pluginname="'.concat(pluginname,'"]')),openInstallAddonForm=pluginnames=>{const args=[],sources={};for(let pluginname of pluginnames){const pluginRegion=getPluginRegion(pluginname);if(null!=pluginRegion&&pluginRegion.dataset.writable){var _pluginRegion$querySe;const source=null===(_pluginRegion$querySe=pluginRegion.querySelector(_selectors.SELECTORS.ADDON_VERSION_RADIO+":checked"))||void 0===_pluginRegion$querySe?void 0:_pluginRegion$querySe.value;""!=="".concat(source)&&(args.push({pluginname:pluginname,source:source}),sources[pluginname]=source)}}if(!args.length)return;const modalForm=new _modalform.default({modalConfig:{title:(0,_str.get_string)("addonplugins_installdialoguetitle","tool_vault")},formClass:"\\tool_vault\\form\\install_plugin_form",args:{plugins:JSON.stringify(args)},saveButtonText:(0,_str.get_string)("continue","moodle")});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(event=>{for(let pluginname of event.detail.installed){var _pluginRegionNode$que;const pluginRegionNode=getPluginRegion(pluginname);null===(_pluginRegionNode$que=pluginRegionNode.querySelector(_selectors.SELECTORS.ADDON_INSTALL_BUTTON))||void 0===_pluginRegionNode$que||_pluginRegionNode$que.remove(),pluginRegionNode.querySelectorAll(_selectors.SELECTORS.ADDON_VERSION_RADIO).forEach((el=>{var _el$closest;el.value!==sources[pluginname]&&(null===(_el$closest=el.closest("label"))||void 0===_el$closest||_el$closest.classList.add("dimmed_text"));el.remove()}))}return _notification.default.alert((0,_str.get_string)("addonplugins_installdialoguetitle","tool_vault"),event.detail.output)})),modalForm.show()}}));

//# sourceMappingURL=install_addon.min.js.map