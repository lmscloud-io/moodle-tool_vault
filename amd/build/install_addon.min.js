define("tool_vault/install_addon",["exports","core_form/modalform","./selectors","core/str","core/toast","core/notification"],(function(_exports,_modalform,_selectors,_str,_toast,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Links to install add-on plugins
   *
   * @module     tool_vault/install_addon
   * @copyright  Marina Glancy
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modalform=_interopRequireDefault(_modalform),_notification=_interopRequireDefault(_notification);let initialised=!1;const CLICOMMAND="php admin/tool/vault/cli/addon_plugins.php";_exports.init=()=>{initialised||(initialised=!0,document.querySelectorAll(_selectors.SELECTORS.ADDON_PLUGIN_REGION).forEach((pluginRegionNode=>{pluginRegionNode.querySelectorAll(_selectors.SELECTORS.ADDON_VERSION_RADIO).forEach((el=>{el.addEventListener("change",(()=>updateCliInstructions(pluginRegionNode,el)))}));const initialRadio=pluginRegionNode.querySelector(_selectors.SELECTORS.ADDON_VERSION_RADIO+":checked");updateCliInstructions(pluginRegionNode,initialRadio);const cliButton=pluginRegionNode.querySelector(_selectors.SELECTORS.ADDON_CLI_BUTTON),installButton=pluginRegionNode.dataset.writable?pluginRegionNode.querySelector(_selectors.SELECTORS.ADDON_INSTALL_BUTTON):null,pluginname=pluginRegionNode.dataset.pluginname;null==installButton||installButton.addEventListener("click",(e=>{var _pluginRegionNode$que;e.preventDefault(),window.console.log("Add-on install button pressed");const source=null===(_pluginRegionNode$que=pluginRegionNode.querySelector(_selectors.SELECTORS.ADDON_VERSION_RADIO+":checked"))||void 0===_pluginRegionNode$que?void 0:_pluginRegionNode$que.value;openInstallAddonForm(pluginRegionNode,{pluginname:pluginname,source:source})})),null==cliButton||cliButton.addEventListener("click",(e=>{e.preventDefault(),window.console.log("Add-on cli button pressed"),pluginRegionNode.dataset.cliexpanded="1"==="".concat(pluginRegionNode.dataset.cliexpanded)?"0":"1"}))})))};const updateCliInstructions=(pluginRegionNode,el)=>{const cli=pluginRegionNode.querySelector(_selectors.SELECTORS.ADDON_CLI_REGION);if(!cli)return;if(!el)return void(cli.innerHTML="");const source="".concat(el.value),pluginname=pluginRegionNode.dataset.pluginname+el.dataset.exactversion;""===source?cli.innerHTML="":source.match(/^backupkey\//)?cli.innerHTML="<pre>"+CLICOMMAND+" --backupkey="+source.substring(10)+" --name="+pluginname+"</pre>":cli.innerHTML="<pre>"+CLICOMMAND+" --name="+pluginname+"</pre>"},openInstallAddonForm=(pluginRegionNode,args)=>{const modalForm=new _modalform.default({modalConfig:{title:"Install add-on plugin"},formClass:"\\tool_vault\\form\\install_plugin_form",args:args,saveButtonText:(0,_str.get_string)("continue","moodle")});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(event=>{return event.detail.success?((0,_toast.add)(event.detail.output),null===(_pluginRegionNode$que2=pluginRegionNode.querySelector(_selectors.SELECTORS.ADDON_CLI_BUTTON))||void 0===_pluginRegionNode$que2||_pluginRegionNode$que2.remove(),null===(_pluginRegionNode$que3=pluginRegionNode.querySelector(_selectors.SELECTORS.ADDON_INSTALL_BUTTON))||void 0===_pluginRegionNode$que3||_pluginRegionNode$que3.remove(),null===(_pluginRegionNode$que4=pluginRegionNode.querySelector(_selectors.SELECTORS.ADDON_CLI_REGION))||void 0===_pluginRegionNode$que4||_pluginRegionNode$que4.remove(),pluginRegionNode.querySelectorAll(_selectors.SELECTORS.ADDON_VERSION_RADIO).forEach((el=>{var _el$closest;el.value!==args.source&&(null===(_el$closest=el.closest("label"))||void 0===_el$closest||_el$closest.classList.add("dimmed_text"));el.remove()})),event.detail.success):_notification.default.alert((0,_str.get_string)("error","moodle"),event.detail.output);var _pluginRegionNode$que2,_pluginRegionNode$que3,_pluginRegionNode$que4})),modalForm.show()}}));

//# sourceMappingURL=install_addon.min.js.map