define("tool_vault/apikey",["exports","core_form/dynamicform","core/pending","core/notification"],(function(_exports,_dynamicform,_pending,_notification){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Allows to enter API key
   *
   * @module     tool_vault/apikey
   * @copyright  2023 Marina Glancy
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_dynamicform=_interopRequireDefault(_dynamicform),_pending=_interopRequireDefault(_pending),_notification=_interopRequireDefault(_notification);const SELECTORS_APIKEY_FORM_CONTAINER="#getapikey_formplaceholder",SELECTORS_APIKEY_IFRAME="#getapikey_iframe",SELECTORS_SIGNIN_BUTTON="#getapikey_signin",SELECTORS_SIGNUP_BUTTON="#getapikey_signup",SELECTORS_ENTER_KEY_BUTTON="#getapikey_enterapikey",openApikeyForm=function(){let apikey=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",autoSubmit=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const pendingPromise=new _pending.default("tool_vault/apikeyform:open");closeLoginSignupModal();const formContainer=document.querySelector(SELECTORS_APIKEY_FORM_CONTAINER),apikeyForm=new _dynamicform.default(formContainer,"\\tool_vault\\form\\apikey_form");apikeyForm.addEventListener(apikeyForm.events.FORM_SUBMITTED,(()=>location.reload())),apikeyForm.load({apikey:apikey}).then((()=>(autoSubmit&&apikeyForm.submitFormAjax(),pendingPromise.resolve()))).catch(_notification.default.exception)},openLoginSignupModal=e=>{document.querySelector(SELECTORS_APIKEY_FORM_CONTAINER).innerHTML="";const signInButton=e.target,loginSignupIframe=document.querySelector(SELECTORS_APIKEY_IFRAME),url=signInButton&&loginSignupIframe?signInButton.dataset.target:null;loginSignupIframe.src=url,loginSignupIframe.style.display="block"},closeLoginSignupModal=()=>{const loginSignupIframe=document.querySelector(SELECTORS_APIKEY_IFRAME);loginSignupIframe.style.display="none",loginSignupIframe.src="about:blank"};_exports.init=()=>{const signInButton=document.querySelector(SELECTORS_SIGNIN_BUTTON),signUpButton=document.querySelector(SELECTORS_SIGNUP_BUTTON),enterApikeyButton=document.querySelector(SELECTORS_ENTER_KEY_BUTTON),loginSignupIframe=document.querySelector(SELECTORS_APIKEY_IFRAME),url=signInButton&&loginSignupIframe?signInButton.dataset.target:null;if(!url)return;const urlHost=url.match(/^(https?:\/\/[^/]+)(.*)$/)[1];signInButton.onclick=openLoginSignupModal,signUpButton&&(signUpButton.onclick=openLoginSignupModal),enterApikeyButton.onclick=()=>openApikeyForm(),window.addEventListener("message",(event=>{event.origin===urlHost&&event.data&&"object"==typeof event.data&&("apikey"===event.data.action?openApikeyForm(event.data.apikey,!0):"close"===event.data.action&&closeLoginSignupModal())}),!1)}}));

//# sourceMappingURL=apikey.min.js.map