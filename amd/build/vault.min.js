define("tool_vault/vault",["exports","core/modal_factory","core/modal_events","core/templates","core/notification","core/str","core/pending","core/fragment"],(function(_exports,_modal_factory,_modal_events,_templates,_notification,_str,_pending,_fragment){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){var _i=null==arr?null:"undefined"!=typeof Symbol&&arr[Symbol.iterator]||arr["@@iterator"];if(null==_i)return;var _s,_e,_arr=[],_n=!0,_d=!1;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise((function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)}))}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initStartRestore=_exports.initStartDryRun=_exports.initStartBackup=_exports.initCollapseExpandBackupLogs=void 0,_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_templates=_interopRequireDefault(_templates),_notification=_interopRequireDefault(_notification),_pending=_interopRequireDefault(_pending),_fragment=_interopRequireDefault(_fragment);var _ref,SELECTORS_START_BACKUP='form[data-action="startbackup"]',SELECTORS_START_DRYRUN='form[data-action="startdryrun"]',SELECTORS_START_RESTORE='form[data-action="startrestore"]',submitForm=function(backupForm,modal){for(var popupBody=modal.getBody()[0],_i=0,_arr=["passphrase","description"];_i<_arr.length;_i++){var i=_arr[_i],el1=popupBody.querySelector('input[name="'.concat(i,'"]')),el2=backupForm.querySelector('input[name="'.concat(i,'"]'));el1&&el2&&(el2.value=el1.value)}backupForm.setAttribute("action",backupForm.getAttribute("data-url")),backupForm.submit()},loadFragmentWithPopup=(_ref=_asyncToGenerator(regeneratorRuntime.mark((function _callee(title,tempBody,fragmentName,contextid){var args,activeModal,fragment,_args=arguments;return regeneratorRuntime.wrap((function(_context){for(;;)switch(_context.prev=_context.next){case 0:return args=_args.length>4&&void 0!==_args[4]?_args[4]:{},activeModal=null,fragment=null,_context.prev=3,_context.next=6,_modal_factory.default.create({type:_modal_factory.default.types.CANCEL,title:title,body:tempBody});case 6:return(activeModal=_context.sent).show(),_context.next=10,_fragment.default.loadFragment("tool_vault",fragmentName,contextid,args);case 10:fragment=_context.sent,activeModal.destroy(),_context.next=17;break;case 14:_context.prev=14,_context.t0=_context.catch(3),activeModal?activeModal.setBody(_context.t0.message):_notification.default.exception(_context.t0);case 17:return _context.abrupt("return",fragment);case 18:case"end":return _context.stop()}}),_callee,null,[[3,14]])}))),function(_x,_x2,_x3,_x4){return _ref.apply(this,arguments)});_exports.initStartBackup=function(){var backupForm=document.querySelector(SELECTORS_START_BACKUP);if(backupForm){var _ref2,contextid=backupForm.getAttribute("data-contextid");backupForm.addEventListener("submit",(_ref2=_asyncToGenerator(regeneratorRuntime.mark((function _callee2(event){var pendingPromise,_yield$getStrings,_yield$getStrings2,title,tempBody,saveButtonText,fragment,modal;return regeneratorRuntime.wrap((function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return event.preventDefault(),pendingPromise=new _pending.default("tool/vault:startBackupPopup"),_context2.next=4,(0,_str.get_strings)([{key:"startbackup",component:"tool_vault"},{key:"pleasewait",component:"tool_vault"},{key:"startbackup",component:"tool_vault"}]);case 4:return _yield$getStrings=_context2.sent,_yield$getStrings2=_slicedToArray(_yield$getStrings,3),title=_yield$getStrings2[0],tempBody=_yield$getStrings2[1],saveButtonText=_yield$getStrings2[2],_context2.next=11,loadFragmentWithPopup(title,tempBody,"start_backup",contextid);case 11:if(fragment=_context2.sent){_context2.next=15;break}return pendingPromise.resolve(),_context2.abrupt("return");case 15:return _context2.next=17,_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:title,body:fragment,buttons:{save:saveButtonText},removeOnClose:!0});case 17:(modal=_context2.sent).show(),modal.getRoot().on(_modal_events.default.save,(function(){return submitForm(backupForm,modal)})),modal.getRoot().on(_modal_events.default.cancel,(function(){return modal.hide()})),pendingPromise.resolve();case 22:case"end":return _context2.stop()}}),_callee2)}))),function(_x5){return _ref2.apply(this,arguments)}))}};_exports.initStartDryRun=function(backupkey){var dryrunForm=document.querySelector(SELECTORS_START_DRYRUN+'[data-backupkey="'.concat(backupkey,'"]'));dryrunForm&&dryrunForm.addEventListener("submit",(function(event){event.preventDefault(),_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:(0,_str.get_string)("startdryrun","tool_vault"),body:_templates.default.render("tool_vault/start_restore_popup",{dryrun:1,encrypted:parseInt(dryrunForm.getAttribute("data-encrypted"))}),buttons:{save:(0,_str.get_string)("startdryrun","tool_vault")},removeOnClose:!0}).then((function(modal){return modal.show(),modal.getRoot().on(_modal_events.default.save,(function(){return submitForm(dryrunForm,modal)})),modal.getRoot().on(_modal_events.default.cancel,(function(){return modal.hide()})),modal})).catch(_notification.default.exception)}))};_exports.initStartRestore=function(backupkey){var restoreForm=document.querySelector(SELECTORS_START_RESTORE+'[data-backupkey="'.concat(backupkey,'"]'));restoreForm&&restoreForm.addEventListener("submit",(function(event){event.preventDefault(),_modal_factory.default.create({type:_modal_factory.default.types.SAVE_CANCEL,title:(0,_str.get_string)("startrestore","tool_vault"),body:_templates.default.render("tool_vault/start_restore_popup",{dryrun:0,encrypted:parseInt(restoreForm.getAttribute("data-encrypted"))}),buttons:{save:(0,_str.get_string)("startrestore","tool_vault")},removeOnClose:!0}).then((function(modal){return modal.show(),modal.getRoot().on(_modal_events.default.save,(function(){return submitForm(restoreForm,modal)})),modal.getRoot().on(_modal_events.default.cancel,(function(){return modal.hide()})),modal})).catch(_notification.default.exception)}))};_exports.initCollapseExpandBackupLogs=function(){var logslong=document.querySelector('[data-vault-purpose="logslong"]'),logsshort=document.querySelector('[data-vault-purpose="logsshort"]');return logslong&&logsshort&&(logslong.querySelector('[data-vault-purpose="togglelogs"]').addEventListener("click",(function(event){event.preventDefault(),logsshort.style.display="block",logslong.style.display="none"})),logsshort.querySelector('[data-vault-purpose="togglelogs"]').addEventListener("click",(function(event){event.preventDefault(),logsshort.style.display="none",logslong.style.display="block"}))),!1}}));

//# sourceMappingURL=vault.min.js.map